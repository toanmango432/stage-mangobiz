{
  "project": "Mango POS Offline V2",
  "branchName": "ralph/frontdesk-fixes",
  "description": "Complete Front Desk module fix - addresses ALL 24 issues found in post-mortem analysis including mock data, unused selectors, incomplete handlers, type safety, and large file splits.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Remove hardcoded mock data from StaffSidebar",
      "description": "As a developer, I want all hardcoded test data removed from StaffSidebar.tsx so that staff cards display real client and ticket information.",
      "acceptanceCriteria": [
        "Remove hardcoded 'Test Client' and 'Test Service' from lines ~791-813",
        "Remove hardcoded lastServiceTime '10:30 AM' mock value",
        "Remove hardcoded nextAppointmentTime '2:00 PM' mock value",
        "Staff cards should show empty/null when no real data exists (not mock data)",
        "Verify in browser: busy staff card shows no fake data",
        "pnpm run typecheck passes for store-app"
      ],
      "priority": 1,
      "passes": true,
      "notes": "File: apps/store-app/src/components/frontdesk/StaffSidebar.tsx. CRITICAL - mock data was shipped in production code."
    },
    {
      "id": "US-002",
      "title": "Wire Redux serviceTickets selector to staff cards",
      "description": "As a user, I want to see real current ticket information on staff cards so I know what each staff member is working on.",
      "acceptanceCriteria": [
        "Use selectServiceTickets from uiTicketsSlice (already imported)",
        "Match tickets to staff using techId, staffId, or assignedTo.id (handle all three)",
        "Display real clientName and serviceName from matched ticket",
        "Handle both string and number staff IDs with proper type guards (no as any)",
        "Verify in browser: create ticket for staff → card shows real client name",
        "pnpm run typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "The selector is already imported but not used in the render loop. Wire it to the staff card mapping."
    },
    {
      "id": "US-003",
      "title": "Wire Redux appointments selector for next appointment times",
      "description": "As a user, I want to see upcoming appointment times on staff cards so I can plan accordingly.",
      "acceptanceCriteria": [
        "Use selectAllAppointments from appointmentsSlice (already imported)",
        "Find next scheduled appointment for each staff member (scheduledStartTime > now)",
        "Display formatted time on staff card nextAppointmentTime field",
        "Handle staff with no upcoming appointments gracefully (show nothing, not mock time)",
        "Verify in browser: book appointment → staff card shows real appointment time",
        "pnpm run typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "selectAllAppointments is imported but never used. Wire it to staff card rendering."
    },
    {
      "id": "US-004",
      "title": "Wire Redux completedTickets selector for last service times",
      "description": "As a user, I want to see when each staff member last completed a service.",
      "acceptanceCriteria": [
        "Use selectCompletedTickets to find paid tickets for each staff",
        "Find most recent completed ticket (by completedAt timestamp)",
        "Display formatted time on staff card lastServiceTime field",
        "Handle staff with no completed tickets gracefully",
        "Verify in browser: complete checkout → staff card shows real last service time",
        "pnpm run typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "completedTickets = status 'paid' (not 'completed' which means pending checkout)."
    },
    {
      "id": "US-005",
      "title": "Remove suppressed unused variables from StaffSidebar",
      "description": "As a developer, I want clean code without suppressed unused variables so the codebase is maintainable.",
      "acceptanceCriteria": [
        "Remove 'void _saveOriginalWidth' and the unused function",
        "Remove 'void _handleResetClick' and the unused function",
        "Remove 'void _getDisplayPriorityTiers' and the unused function",
        "If any of these features are needed, create separate stories for them",
        "No void statements to suppress unused variables",
        "pnpm run typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Lines ~977-979 have void statements hiding unused code. Delete the unused functions entirely."
    },
    {
      "id": "US-006",
      "title": "Implement AddStaffNoteModal onConfirm handler with edit support",
      "description": "As a user, I want to add and edit notes to staff members so I can track important information.",
      "acceptanceCriteria": [
        "AddStaffNoteModal onConfirm must dispatch Redux action to save note",
        "Create or use existing staff note action in staffSlice",
        "Close modal and reset selectedStaffForNote after save",
        "Load existing staff notes from Redux when opening modal",
        "Display edit mode if note already exists",
        "Show success feedback (toast or visual confirmation)",
        "Verify in browser: open modal → add note → confirm → note is saved",
        "pnpm run typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Modal exists but onConfirm callback doesn't dispatch any Redux action. Also support editing existing notes."
    },
    {
      "id": "US-007",
      "title": "Implement StaffDetailsPanel action callbacks",
      "description": "As a user, I want staff detail panel actions to work so I can manage staff from the panel.",
      "acceptanceCriteria": [
        "onAddTicket callback opens ticket panel with staff pre-selected",
        "onAddNote callback opens AddStaffNoteModal with staff selected",
        "onEditTeam callback navigates to team settings for that staff member",
        "onQuickCheckout callback triggers checkout flow if staff has active ticket",
        "All callbacks must be implemented (not undefined)",
        "Verify in browser: click each action button → correct action happens",
        "pnpm run typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "StaffDetailsPanel has callback props but handlers are not implemented in parent."
    },
    {
      "id": "US-008",
      "title": "Replace as any type casts with proper type guards",
      "description": "As a developer, I want type-safe code so TypeScript can catch errors at compile time.",
      "acceptanceCriteria": [
        "Replace (modifiedStaffMember as any) with proper interface extension",
        "Replace staff.find((s: any) => ...) with typed staff array",
        "Create StaffWithTicketInfo interface extending base Staff type",
        "Use typeof checks for string/number staff ID handling",
        "Replace (viewMode as any) on line 548 with type guard",
        "Replace (modifiedStaffMember as any) on lines 1191, 1249",
        "No as any casts without documented reason in comment",
        "pnpm run typecheck passes with strict mode"
      ],
      "priority": 8,
      "passes": true,
      "notes": "At least 15 instances of 'as any' in StaffSidebar. Each must be replaced with proper typing."
    },
    {
      "id": "US-009",
      "title": "Split StaffSidebar into module structure",
      "description": "As a developer, I want StaffSidebar split into smaller files so the code is maintainable.",
      "acceptanceCriteria": [
        "Create StaffSidebar/ directory with module structure",
        "Extract StaffCardGrid component (~150 lines) for card rendering",
        "Extract StaffSidebarHeader component (~100 lines) for controls",
        "Extract useStaffFiltering hook for filter logic",
        "Extract getStaffTicketInfo logic to useStaffTicketInfo hook",
        "Main StaffSidebar.tsx should be under 300 lines",
        "All imports/exports work correctly",
        "Verify in browser: Front Desk page renders correctly after split",
        "pnpm run typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Current file is 902+ lines. Target is <300 lines per file. Follow module structure in codebase-patterns.md."
    },
    {
      "id": "US-010",
      "title": "Wire MobileStaffActionSheet to MobileTeamSection",
      "description": "As a mobile user, I want staff action sheet to appear when I tap a staff card so I can perform actions.",
      "acceptanceCriteria": [
        "MobileTeamSection renders MobileStaffActionSheet component",
        "Tapping staff card opens action sheet with correct staff selected",
        "Action sheet buttons trigger actual actions (not just log/close)",
        "onAddTicket opens ticket panel, onAddNote opens note modal",
        "Verify in browser (mobile viewport): tap staff → action sheet opens → actions work",
        "pnpm run typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "MobileStaffActionSheet was already integrated. This iteration fixed mock data fallbacks in convertToStaffMember function."
    },
    {
      "id": "US-011",
      "title": "Add integration tests for real data flow",
      "description": "As a developer, I want tests that verify real Redux data displays correctly on staff cards.",
      "acceptanceCriteria": [
        "Test: mock Redux state with service tickets → verify card shows real client name",
        "Test: mock Redux state with appointments → verify card shows real appointment time",
        "Test: mock Redux state with completed tickets → verify card shows real last service",
        "Tests use Redux Provider wrapper with configured store",
        "Tests do not rely on hardcoded 'Test Client' strings",
        "All new tests pass: pnpm test StaffSidebar"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Added staffHooksIntegration.test.ts with 20 tests verifying real Redux data flow through hooks."
    },
    {
      "id": "US-012",
      "title": "Verify and fix mobile responsiveness for staff cards",
      "description": "As a mobile user, I want staff cards to display properly on smaller screens.",
      "acceptanceCriteria": [
        "Staff cards adapt to viewport width (no horizontal overflow)",
        "Touch targets are at least 44x44px for mobile",
        "Text is readable at mobile sizes (no truncation hiding important info)",
        "Action sheet is usable on small screens",
        "Verify in browser at 375px width: all cards render correctly",
        "pnpm run typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Added Off section to busyStatus grouped view and removed hardcoded '2:00p' fallback in compact mode."
    },
    {
      "id": "US-013",
      "title": "Fix dynamic Tailwind class generation",
      "description": "As a developer, I want CSS to work in production so staff cards render correctly.",
      "acceptanceCriteria": [
        "Replace getGridClass function (lines 512-573) with CSS Grid auto-fit/minmax",
        "Use static Tailwind classes instead of dynamic string concatenation",
        "All view modes (normal, compact, ultra-compact) work correctly",
        "Run production build: pnpm run build",
        "Verify CSS is not purged by checking staff card grid renders",
        "pnpm run typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Already resolved in US-009 module split. gridHelpers.ts uses CSS Grid auto-fit/minmax with static classes. Production build verified - all custom grid classes present in CSS."
    },
    {
      "id": "US-014",
      "title": "Migrate localStorage state to Redux",
      "description": "As a user, I want my settings to sync across devices.",
      "acceptanceCriteria": [
        "Move viewMode state to FrontDeskSettings Redux slice",
        "Move sidebarWidth to viewState or FrontDeskSettings slice",
        "Remove all localStorage.getItem/setItem calls from StaffSidebar",
        "Settings persist after page reload (via Redux persist)",
        "Verify in browser: change settings → refresh → settings retained",
        "Remove 150+ lines of localStorage logic",
        "pnpm run typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Migrated useViewMode and useSidebarWidth hooks to Redux. Added staff sidebar state to FrontDeskSettings viewState. Added initialization effect in StaffSidebar.tsx to sync teamSettings.viewWidth → Redux on mount."
    },
    {
      "id": "US-015",
      "title": "Implement staff note persistence in MobileTeamSection",
      "description": "As a mobile user, I want notes I add to persist.",
      "acceptanceCriteria": [
        "Notes dispatch Redux action to save (not just local state)",
        "Load existing notes when staff selected",
        "Show note count indicator on staff cards with notes",
        "Verify in browser (mobile): add note → refresh → note still exists",
        "Remove TODO comment on line 205",
        "pnpm run typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Implemented using Redux setStaffNote action. Added hasNote field to StaffMember interface and note indicator badge to StaffCardVertical."
    },
    {
      "id": "US-016",
      "title": "Clarify staff data source (Redux vs useTickets)",
      "description": "As a developer, I want clear data source documentation.",
      "acceptanceCriteria": [
        "Document which selectors are authoritative for staff list",
        "Either use Redux selectors OR useTickets hook, not both",
        "Add JSDoc comments explaining data flow",
        "Remove redundant data fetching",
        "pnpm run typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Added JSDoc documentation to StaffSidebar.tsx and useTicketsCompat.ts. Clarified that useTicketsCompat IS Redux-backed (compatibility wrapper), so there's no conflict - all data comes from Redux."
    },
    {
      "id": "US-017",
      "title": "Consolidate teamSettings with FrontDeskSettings Redux slice",
      "description": "As a developer, I want single source of truth for settings.",
      "acceptanceCriteria": [
        "Remove local teamSettings state (lines 94-100)",
        "Use FrontDeskSettings slice for all team section settings",
        "TeamSettingsPanel updates Redux, not localStorage",
        "Settings changes reflect immediately across components",
        "pnpm run typecheck passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Added TeamSettings interface and reducers to frontDeskSettingsSlice. StaffSidebar now uses Redux selector instead of local state. TeamSettingsPanel re-exports types for backward compatibility."
    },
    {
      "id": "US-018",
      "title": "Add staff note edit functionality",
      "description": "As a user, I want to edit existing staff notes.",
      "acceptanceCriteria": [
        "Load existing note when opening AddStaffNoteModal",
        "Pass currentNote prop to modal",
        "Show 'Edit Note' title when editing, 'Add Note' when creating",
        "Pre-fill textarea with existing note content",
        "Verify in browser: click existing note → edit → save → updated",
        "pnpm run typecheck passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Already implemented in US-006 and US-015. StaffSidebar and MobileTeamSection both pass currentNote={staffNotes[String(id)]} to AddStaffNoteModal. Modal shows 'Edit Staff Note' title and pre-fills content."
    },
    {
      "id": "US-019",
      "title": "Consolidate modal state with useModalStack hook",
      "description": "As a developer, I want simpler modal state management.",
      "acceptanceCriteria": [
        "Create useModalStack hook for managing multiple modals",
        "Replace 4 separate state pairs (lines 102-129)",
        "Single hook manages all modal visibility and selected items",
        "Modals still work correctly after refactor",
        "Easier to test modal interactions",
        "pnpm run typecheck passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Created useModalStack hook managing 5 modals (teamSettings, turnTracker, staffNote, staffDetails, resetConfirmation). Provides both compatibility API and typed open/close methods."
    },
    {
      "id": "US-020",
      "title": "Fix window event type safety",
      "description": "As a developer, I want type-safe event listeners.",
      "acceptanceCriteria": [
        "Replace (window as any) on lines 131, 133",
        "Create typed CustomEvent interface for 'open-turn-tracker'",
        "Use proper event listener typing",
        "pnpm run typecheck passes"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Added StaffSidebarCustomEvents interface, extended WindowEventMap globally, and created dispatchStaffSidebarEvent() type-safe function. FrontDesk.tsx now uses the type-safe dispatcher."
    },
    {
      "id": "US-021",
      "title": "Extract getStaffTicketInfo to useStaffTicketInfo hook",
      "description": "As a developer, I want reusable ticket info logic.",
      "acceptanceCriteria": [
        "Create useStaffTicketInfo.ts hook",
        "Move 60+ lines of logic from lines 982-1040",
        "Hook returns { getStaffTicketInfo } function",
        "Main component imports and uses hook",
        "Logic is testable in isolation",
        "pnpm run typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Already implemented in US-009 (StaffSidebar module split). Hook exists at StaffSidebar/hooks/useStaffTicketInfo.ts (112 lines). Used in StaffSidebar.tsx line 85."
    },
    {
      "id": "US-022",
      "title": "Remove unused determineStaffStatus export",
      "description": "As a developer, I want clean code without dead exports.",
      "acceptanceCriteria": [
        "Search codebase for any usages of determineStaffStatus first",
        "If used elsewhere, keep but fix typing (remove as any)",
        "If unused, delete completely from line 37",
        "pnpm run typecheck passes"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Function was exported but never imported - verified with grep. Removed 18-line function and all re-exports from staffHelpers.ts, utils/index.ts, StaffSidebar.tsx, and module index.ts."
    },
    {
      "id": "US-023",
      "title": "Split WaitListSection into module structure",
      "description": "As a developer, I want maintainable file sizes.",
      "acceptanceCriteria": [
        "Create WaitListSection/ directory",
        "Extract WaitListCard component",
        "Extract useWaitListFiltering hook",
        "Extract types to types.ts",
        "Main file under 300 lines",
        "All functionality preserved",
        "Verify in browser: wait list renders correctly after split",
        "pnpm run typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": "Current: 1658 lines. Far exceeds 500-line guideline."
    },
    {
      "id": "US-024",
      "title": "Split ServiceSection into module structure",
      "description": "As a developer, I want maintainable file sizes.",
      "acceptanceCriteria": [
        "Create ServiceSection/ directory",
        "Extract ServiceCard component",
        "Extract useServiceFiltering hook",
        "Extract types to types.ts",
        "Main file under 300 lines",
        "All functionality preserved",
        "Verify in browser: service section renders correctly after split",
        "pnpm run typecheck passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": "Current: 1395 lines. Far exceeds 500-line guideline."
    }
  ]
}
