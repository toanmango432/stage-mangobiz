## Codebase Patterns

> Add reusable patterns discovered during implementation here.
> These persist across iterations and help future Ralph runs.

<!-- Add patterns as you discover them -->

### Next.js + Existing src/pages Directory
Next.js 16 requires `app/` and `pages/` directories to be under the same parent folder.
Since `src/pages/` already exists with React components (not Next.js pages), the `app/`
directory must be placed at `src/app/` (not project root `app/`). PRD paths referencing
`apps/online-store/app/` should be read as `apps/online-store/src/app/`.

### Next.js 16 Config Changes
- `eslint` key in next.config.ts is no longer supported (removed in Next.js 16)
- Use `turbopack.root` to set monorepo root and avoid lockfile detection warnings
- `typescript.ignoreBuildErrors` is still supported

---

# Ralph Progress Log

Started: Mon Jan 27 11:13:00 EST 2026
Branch: ralph/online-store-nextjs-migration
Run: online-store-nextjs-migration

---

## 2026-01-27 - US-001: Install Next.js and create next.config.ts
Commit: b11fad3

**Why this story?** First story with no dependencies and highest priority (1). Foundation for all other stories.

**Changes:**
- apps/online-store/package.json: Added next@16.1.5, eslint-config-next@16.1.5; updated scripts (dev→next dev, build→next build, start→next start, typecheck→tsc --noEmit); kept Vite fallbacks (dev:vite, build:vite)
- apps/online-store/next.config.ts (NEW): Created with standalone output, transpilePackages, typescript.ignoreBuildErrors, turbopack.root for monorepo
- apps/online-store/src/app/layout.tsx (NEW): Minimal root layout stub
- apps/online-store/src/app/page.tsx (NEW): Minimal home page stub
- .gitignore: Added .next/ entry
- apps/online-store/next-env.d.ts (NEW): Auto-generated by Next.js
- pnpm-lock.yaml: Updated with new dependencies

**Learnings:**
- Next.js 16 removed `eslint` config key from next.config.ts — use CLI flags or separate eslint config instead
- `app/` directory MUST be under `src/` (not project root) when `src/pages/` exists — Next.js requires both directories under the same parent
- `next build` fails because Next.js treats `src/pages/*.tsx` as Pages Router routes (expected during migration, resolved when pages are migrated)
- `turbopack.root` config silences monorepo lockfile detection warnings
- `next dev` works fine even with src/pages present — only build tries to compile Pages Router routes

**Patterns to sync:**
- Pattern: Next.js src/app placement — When migrating to Next.js with existing src/pages directory, place app/ under src/ to satisfy same-parent requirement

**Next story suggestion:** US-002 (Update TypeScript config for Next.js) — direct dependency on US-001, same config category, completes the TypeScript setup

---

<!--
SESSION SUMMARY TEMPLATE (append when session ends or blocked):

## Session Summary - [Date]

**Completed this session:** [X] stories
**Total progress:** [Y]/[Z] stories ([percent]%)

**Blocked stories:** (if any)
- [US-XXX]: [Reason - e.g., "Missing dependency", "Pre-existing test failure", "PRD unclear"]

**Patterns synced:** [count] new patterns added to patterns.md

**Next session should:**
- Start with: [US-XXX] - [reason]
- Resolve blocker: [description if applicable]

---
-->

## Session Summary - 2026-01-27

**Completed this session:** 1 story
**Total progress:** 1/49 stories (2%)

**Blocked stories:** None

**Patterns synced:** 2 new patterns added to patterns.md (Next.js src/app placement, Next.js 16 config differences)

**Next session should:**
- Start with: US-002 - Update TypeScript config for Next.js (direct dependency on US-001, same config category)
- Key note: All PRD paths referencing `app/` should use `src/app/` instead (documented in Codebase Patterns above)

---
