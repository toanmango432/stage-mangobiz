## Codebase Patterns

See patterns.md for accumulated patterns from previous runs.

**Front Desk Module Patterns:**
- StaffCardVertical is the shared component for mobile/desktop staff display
- frontDeskSettingsSlice controls all Front Desk settings (view modes, sorting, drag-drop)
- urgencyUtils.ts contains threshold configs and color mappings
- Use design tokens from @/design-system for all colors
- Ticket cards use ServiceTicketCard and variants (WaitListTicketCard, PendingTicketCard)
- Section headers use CollapsibleSection pattern with count badges

---

# Ralph Progress Log
Started: 2026-01-13
Branch: ralph/frontdesk-update

<!-- Ralph appends entries below -->

## 2026-01-13 22:59 - US-001: Connect StaffCard displayConfig to FrontDeskSettings
Commit: ae9347b
- Added imports for useAppSelector and selectFrontDeskSettings from Redux
- StaffSidebar now reads settings from Redux frontDeskSettingsSlice
- Connected displayConfig to FrontDeskSettings: showTurnCount, showNextAppointment, showServicedAmount, showTicketCount, showLastDone
- Redux settings take priority, prop settings as fallback for backwards compatibility
- Files changed: apps/store-app/src/components/frontdesk/StaffSidebar.tsx
- **Learnings for future iterations:**
  - StaffSidebar has TWO settings systems: TeamSettingsPanel (localStorage) and FrontDeskSettings (Redux)
  - FrontDeskSettings is the main settings panel accessed via More > Front Desk Layout
  - TeamSettingsPanel is a legacy local settings (accessed via gear icon in Team section header)
  - Redux settings should be the single source of truth for card display options
---

## 2026-01-13 23:15 - US-002: Add More Options dropdown menu to StaffCard
Commit: 0413b05
- Added action settings to DisplayConfig interface: showMoreOptionsButton, showAddTicketAction, showAddNoteAction, showEditTeamAction, showQuickCheckoutAction
- Added action callbacks to StaffCardVerticalProps: onAddTicket, onAddNote, onEditTeam, onQuickCheckout
- Implemented DropdownMenu using Radix UI components from @/components/ui/dropdown-menu
- Menu items respect displayConfig settings (conditional rendering)
- Quick Checkout only visible when staff is busy and has activeTicket
- Files changed:
  - apps/store-app/src/components/StaffCard/hooks/useStaffCardDisplay.ts
  - apps/store-app/src/components/StaffCard/StaffCardVertical.tsx
- **Learnings for future iterations:**
  - Use existing DropdownMenu component from @/components/ui/dropdown-menu (shadcn/radix wrapper)
  - DisplayConfig interface in useStaffCardDisplay.ts is the central config for StaffCard display options
  - Action settings from FrontDeskSettingsData should map to DisplayConfig for consistency
  - Callbacks use staffId parameter so parent component can identify which staff triggered the action
---

## 2026-01-13 23:45 - US-003: Implement Add Ticket action on staff cards
Commit: 365a845
- Added useTicketPanel hook import to StaffSidebar for ticket creation flow
- Created handleAddTicket callback that opens ticket panel with staff pre-selected
- Passes techId and technician name to openTicketWithData for pre-selection
- Connected action settings (showAddTicketAction, showAddNoteAction, etc.) from FrontDeskSettings to displayConfig
- Passed onAddTicket callback to StaffCardVertical component
- Files changed:
  - apps/store-app/src/components/frontdesk/StaffSidebar.tsx
- **Learnings for future iterations:**
  - useTicketPanel provides openTicketWithData(ticket) to open ticket panel with pre-filled data
  - TicketData interface includes techId and technician fields for staff pre-selection
  - Staff IDs may be strings or numbers - need to handle both when finding staff member
  - Action settings from FrontDeskSettings are passed through displayConfig to StaffCardVertical
---

## 2026-01-13 - US-004: Implement Add Note action on staff cards
Commit: 5fac7c6
- Created AddStaffNoteModal component for staff-specific notes (apps/store-app/src/components/frontdesk/AddStaffNoteModal.tsx)
- Added state management for staff note modal in StaffSidebar: showStaffNoteModal, selectedStaffForNote
- Created handleAddNote callback that finds staff member and opens note modal
- Created handleSaveStaffNote callback (placeholder for API integration)
- Passed onAddNote callback to StaffCardVertical component
- Modal uses teal color scheme to match Team Section styling
- Files changed:
  - apps/store-app/src/components/frontdesk/AddStaffNoteModal.tsx (new)
  - apps/store-app/src/components/frontdesk/StaffSidebar.tsx
- **Learnings for future iterations:**
  - Existing AddNoteModal is for tickets (requires ticketId, ticketNumber, clientName)
  - Created separate AddStaffNoteModal for staff notes to avoid coupling
  - Staff notes need their own storage/API integration (TODO in handleSaveStaffNote)
  - Use selectedStaffForNote state to track which staff member the modal is for
---

## 2026-01-13 - US-005: Implement Edit Team Member action on staff cards
Commit: 96528c3
- Added useAppDispatch hook import to StaffSidebar for Redux dispatch
- Added setSelectedMember import from teamSlice for pre-selecting team member
- Created handleEditTeam callback that:
  1. Finds staff member by numeric ID (handles string/number ID conversion)
  2. Pre-selects the staff member in Redux teamSlice using setSelectedMember
  3. Navigates to team-settings module via custom event (navigate-to-module)
- Passed onEditTeam callback to StaffCardVertical component
- Files changed:
  - apps/store-app/src/components/frontdesk/StaffSidebar.tsx
- **Learnings for future iterations:**
  - AppShell listens for 'navigate-to-module' custom events to switch modules
  - UIStaff.id is already the team member UUID string (from TeamMemberSettings.id)
  - teamSlice's setSelectedMember expects a string ID matching TeamMemberSettings.id
  - Navigation pattern: dispatch Redux action first, then trigger module navigation event
---

## 2026-01-13 - US-006: Implement Quick Checkout action on staff cards
Commit: 9a69a44
- Added serviceTickets to useTickets() destructuring to get in-service tickets
- Created handleQuickCheckout callback that:
  1. Finds staff member by numeric ID (handles string/number conversion)
  2. Finds the staff's in-service ticket by matching techId/staffId/assignedTo.id
  3. Converts UITicket to TicketData format for the checkout panel
  4. Opens the ticket panel with openTicketWithData()
- Passed onQuickCheckout callback to StaffCardVertical component
- Quick Checkout only visible when staff is busy AND has activeTicket (existing StaffCardVertical logic)
- Files changed:
  - apps/store-app/src/components/frontdesk/StaffSidebar.tsx
- **Learnings for future iterations:**
  - UITicket uses `number` (not ticketNumber), `service` (singular string), `checkoutServices` (detailed array)
  - useTickets() returns `serviceTickets` for in-service tickets
  - openTicketWithData() accepts TicketData and stores in localStorage for TicketPanel to load
  - Staff can be matched by techId, staffId, or assignedTo.id fields on the ticket
---
