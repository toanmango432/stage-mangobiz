{
  "branchName": "ralph/check-in-production",
  "projectName": "Mango Check-In App (Production Ready - One-Shot Build)",
  "version": "3.0-comprehensive",
  "description": "Complete autonomous build with integrated skills: design, testing, security, performance",
  "metadata": {
    "agent": "Amp (Sourcegraph Amp CLI)",
    "runner": "Ralph Wiggum (Autonomous Loop)",
    "environment": "Bash + Amp",
    "maxIterations": 30,
    "completionPromise": "CHECK_IN_APP_PRODUCTION_READY",
    "skillsIntegrated": [
      "mango-designer",
      "compound-engineering",
      "test-generator",
      "performance-profiler",
      "security-audit",
      "code-review",
      "documentation-generator"
    ],
    "phases": 4,
    "totalStories": 24,
    "estimatedDays": 5,
    "costEstimate": "$150-250"
  },
  "phases": [
    {
      "name": "PHASE 0: DESIGN & FOUNDATION",
      "duration": "~1 day",
      "skills": ["mango-designer", "compound-engineering"],
      "description": "Design system + Redux foundation (do BEFORE stories start)",
      "critical": true,
      "stories": [
        {
          "id": "SETUP-001",
          "title": "Design System with mango-designer",
          "description": "Load mango-designer skill. Review Check-In UI, create design specs (colors, typography, spacing, tablet layouts). Generate design document. Do NOT code yet.",
          "priority": 0,
          "passes": false,
          "skillLoad": "mango-designer",
          "outputs": [
            "design-system.md",
            "component-specs.md",
            "tablet-layouts.md"
          ],
          "notes": "This must be done BEFORE any coding to establish design consistency"
        },
        {
          "id": "SETUP-002",
          "title": "Redux + DataService + MQTT Foundation",
          "description": "Setup Redux store with slices (checkin, client, auth, ui, sync). Create dataService facade. Initialize Supabase client. Setup MQTT client. Add error boundaries and auth context.",
          "priority": 0.5,
          "passes": false,
          "skillLoad": "compound-engineering",
          "linesOfCode": 300,
          "notes": "Critical foundation - everything else depends on this"
        }
      ]
    },
    {
      "name": "PHASE 1: INTEGRATION (Tiers 1-2)",
      "duration": "~1.5 days",
      "skills": ["test-generator"],
      "description": "Wire UI pages to backend via Redux + DataService",
      "stories": [
        {
          "id": "CHECKIN-301",
          "title": "Phone Lookup Integration (Welcome → Verify)",
          "priority": 1,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["unit", "integration"],
          "acceptanceCriteria": [
            "Redux thunk calls dataService.clients.getByPhone",
            "Verify page shows real client data",
            "Not-found shows Create New option",
            "< 2 second lookup"
          ]
        },
        {
          "id": "CHECKIN-302",
          "title": "New Client Registration",
          "priority": 2,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["unit", "integration"]
        },
        {
          "id": "CHECKIN-303",
          "title": "Service Catalog Fetch & Cache",
          "priority": 3,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["unit", "integration"]
        },
        {
          "id": "CHECKIN-304",
          "title": "Technician Status (MQTT Subscribe)",
          "priority": 4,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["integration"]
        },
        {
          "id": "CHECKIN-305",
          "title": "Check-In Creation & Publishing",
          "priority": 5,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["integration"]
        },
        {
          "id": "CHECKIN-306",
          "title": "Queue Position Updates (MQTT)",
          "priority": 6,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["integration"]
        },
        {
          "id": "CHECKIN-307",
          "title": "Client Called Handler (MQTT)",
          "priority": 7,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["integration"]
        },
        {
          "id": "CHECKIN-308",
          "title": "Offline Mode - IndexedDB Sync",
          "priority": 8,
          "passes": false,
          "skillLoad": "test-generator",
          "tests": ["integration"]
        }
      ]
    },
    {
      "name": "PHASE 2: FEATURES (Tier 3)",
      "duration": "~1 day",
      "skills": ["mango-designer", "test-generator"],
      "description": "Feature stories with design polish from Phase 0",
      "stories": [
        {
          "id": "CHECKIN-309",
          "title": "Guest Check-In",
          "priority": 9,
          "passes": false,
          "skillLoad": "test-generator",
          "designApplied": true
        },
        {
          "id": "CHECKIN-310",
          "title": "QR Code Appointment Lookup",
          "priority": 10,
          "passes": false,
          "skillLoad": "test-generator"
        },
        {
          "id": "CHECKIN-311",
          "title": "SMS Notifications",
          "priority": 11,
          "passes": false,
          "skillLoad": "test-generator"
        },
        {
          "id": "CHECKIN-312",
          "title": "Admin Assistance Mode",
          "priority": 12,
          "passes": false,
          "skillLoad": "test-generator"
        },
        {
          "id": "CHECKIN-313",
          "title": "Analytics Event Tracking",
          "priority": 13,
          "passes": false,
          "skillLoad": "test-generator"
        },
        {
          "id": "CHECKIN-319",
          "title": "Service Upsell Cards",
          "priority": 14,
          "passes": false,
          "skillLoad": "test-generator",
          "designApplied": true
        },
        {
          "id": "CHECKIN-320",
          "title": "Loyalty Points Display",
          "priority": 15,
          "passes": false,
          "skillLoad": "test-generator",
          "designApplied": true
        },
        {
          "id": "CHECKIN-321",
          "title": "Duration & Price Display",
          "priority": 16,
          "passes": false,
          "skillLoad": "test-generator",
          "designApplied": true
        }
      ]
    },
    {
      "name": "PHASE 3: QUALITY (Tier 4)",
      "duration": "~1.5 days",
      "skills": ["test-generator", "performance-profiler", "security-audit", "code-review"],
      "description": "Testing, security, performance, accessibility",
      "stories": [
        {
          "id": "CHECKIN-314",
          "title": "Accessibility (WCAG 2.1 AA)",
          "priority": 17,
          "passes": false,
          "skillLoad": "test-generator",
          "requirements": [
            "ARIA labels on all interactive elements",
            "44x44px touch targets",
            "4.5:1 color contrast",
            "Keyboard navigation",
            "Screen reader support"
          ]
        },
        {
          "id": "CHECKIN-315",
          "title": "Security Hardening",
          "priority": 18,
          "passes": false,
          "skillLoad": "security-audit",
          "requirements": [
            "Input validation",
            "Rate limiting",
            "CSRF protection",
            "Data sanitization",
            "RLS policy audit"
          ]
        },
        {
          "id": "CHECKIN-316",
          "title": "Unit Tests (70% Coverage)",
          "priority": 19,
          "passes": false,
          "skillLoad": "test-generator",
          "targetCoverage": "70%",
          "requirements": [
            "Redux thunks",
            "DataService calls",
            "Utility functions",
            "Form validation"
          ]
        },
        {
          "id": "CHECKIN-317",
          "title": "E2E Tests (Happy Path)",
          "priority": 20,
          "passes": false,
          "skillLoad": "test-generator",
          "framework": "Playwright",
          "requirements": [
            "Returning client flow",
            "New client registration",
            "Guest addition",
            "Offline sync"
          ]
        },
        {
          "id": "CHECKIN-318",
          "title": "Performance Optimization",
          "priority": 21,
          "passes": false,
          "skillLoad": "performance-profiler",
          "requirements": [
            "Bundle size < 500KB gzipped",
            "Page load < 2 seconds",
            "Code splitting",
            "Image optimization"
          ]
        },
        {
          "id": "CHECKIN-322",
          "title": "Final Code Review & Cleanup",
          "priority": 22,
          "passes": false,
          "skillLoad": "code-review",
          "requirements": [
            "Code quality audit",
            "Best practices",
            "Pattern consistency",
            "Production readiness"
          ]
        },
        {
          "id": "CHECKIN-323",
          "title": "Documentation Generation",
          "priority": 23,
          "passes": false,
          "skillLoad": "documentation-generator",
          "requirements": [
            "API documentation",
            "Architecture docs",
            "Component storybook",
            "Deployment guide"
          ]
        },
        {
          "id": "CHECKIN-324",
          "title": "Production Validation & Checklist",
          "priority": 24,
          "passes": false,
          "skillLoad": "code-review",
          "requirements": [
            "Security checklist",
            "Performance checklist",
            "Testing checklist",
            "Deployment readiness"
          ]
        }
      ]
    }
  ],
  "rules": {
    "maxIterations": 30,
    "completionPromise": "CHECK_IN_APP_PRODUCTION_READY",
    "oneTaskPerIteration": true,
    "requireTestsBeforeCommit": true,
    "appendToProgress": true,
    "workFromCleanCommits": true
  },
  "skillLoadingStrategy": {
    "SETUP-001": "mango-designer",
    "SETUP-002": "compound-engineering",
    "CHECKIN-3xx": "test-generator",
    "CHECKIN-314": "test-generator",
    "CHECKIN-315": "security-audit",
    "CHECKIN-316": "test-generator",
    "CHECKIN-317": "test-generator",
    "CHECKIN-318": "performance-profiler",
    "CHECKIN-322": "code-review",
    "CHECKIN-323": "documentation-generator",
    "CHECKIN-324": "code-review"
  },
  "preChecks": [
    {
      "story": "CHECKIN-301",
      "check": "grep -r 'useAppSelector.*clients' src/ | wc -l",
      "condition": "Must be 0 before starting (no existing clients integration)"
    },
    {
      "story": "CHECKIN-316",
      "check": "find src -name '*.test.ts' | wc -l",
      "condition": "Should be minimal before story, >100 after"
    },
    {
      "story": "CHECKIN-318",
      "check": "npm run build && du -sh dist",
      "condition": "Check baseline bundle size"
    }
  ],
  "commitStrategy": {
    "format": "feat(check-in): [STORY-ID] - [Title]",
    "frequency": "After each passing story",
    "verify": [
      "pnpm lint",
      "pnpm build",
      "pnpm test (if applicable)"
    ]
  },
  "progressTracking": {
    "file": "progress.txt",
    "appendFormat": "## Story [ID] - [Title]\n- Thread: [URL]\n- Time: [HH:MM]\n- Files changed: [list]\n- Tests: [pass/fail]\n- Coverage: [%]\n- Notes: [learnings]",
    "updatePrd": "Set passes: true after each successful story"
  },
  "completionCriteria": {
    "allStoriesPassed": true,
    "testCoverage": "≥70%",
    "bundleSize": "<500KB gzipped",
    "accessibility": "WCAG 2.1 AA",
    "security": "0 critical issues",
    "performance": "Lighthouse ≥90",
    "documentation": "Complete",
    "production": "Ready to deploy"
  },
  "notes": {
    "philosophy": "One-time comprehensive build with skill integration. Quality > speed.",
    "phases": "Phase 0 sets foundation (design + Redux). Phases 1-3 are sequential.",
    "skills": "Each phase loads appropriate skills. Mango-designer for design, test-generator for testing, security-audit for security, etc.",
    "validation": "Stories include acceptance criteria. Ralph must verify before moving to next.",
    "outputs": "Production-ready app + documentation + test suite + design system"
  }
}
