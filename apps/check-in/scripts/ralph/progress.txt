# Ralph Progress Log
Started: Fri Jan 10 2026
Branch: ralph/check-in-production
Stories: 24 (Phase 0-3: Design, Integration, Features, Quality)

## Codebase Patterns

> Reusable patterns discovered during implementation. Add general learnings here.

- Use dataService for all data operations, never Supabase directly
- Redux thunks go in src/store/slices/
- Design tokens in src/design-system/
- MQTT provider implemented locally in src/providers/MqttProvider.tsx (standalone, not using @mango/mqtt)
- Components follow pattern: src/components/[ComponentName]/index.tsx
- Types are in src/types/index.ts
- Use Zod for form validation with React Hook Form
- Touch targets must be minimum 44x44px for tablet use
- All pages are in src/pages/ directory
- Design documentation lives in docs/design/ directory
- Mango brand color is #1a5f4a (primary) and #d4a853 (secondary/accent)
- Background is warm cream #faf9f7, not pure white
- Typography: Plus Jakarta Sans for headers, Work Sans for body
- Testing: Vitest + @testing-library/react for unit/integration tests, setup in src/testing/setup.ts
- Utility functions: phone formatting, validation, etc. in src/utils/index.ts
- For async thunks that fetch lists, create dedicated slice (e.g., servicesSlice) not just in checkinSlice
- Selected items stored in checkinSlice, catalog data in dedicated slices (servicesSlice, etc.)
- MQTT subscription hooks: useXxxMqtt pattern (e.g., useTechnicianMqtt) - subscribe in useEffect, dispatch to Redux

---

## Sat Jan 10 2026 - US-001
Thread: https://ampcode.com/threads/T-019ba7ba-f376-753f-8e9f-d06923244948
- Created comprehensive design system documentation
- Files changed:
  - docs/design/design-system.md (color palette, typography, spacing, shadows)
  - docs/design/component-specs.md (buttons, inputs, cards, modals, icons)
  - docs/design/tablet-layouts.md (7-10" tablet layouts, screen-by-screen specs)
  - docs/design/micro-interactions.md (animations, transitions, loading states)
- **Learnings for future iterations:**
  - Existing pages already follow Mango design patterns (colors, fonts)
  - CSS uses inline styles with Tailwind classes, not CSS-in-JS
  - Animations defined inline with <style> blocks in components
  - Kiosk mode class prevents text selection and touch callouts
---

## Sat Jan 10 2026 - US-002
Thread: https://ampcode.com/threads/T-019ba7c1-9a16-77fe-a801-371a97d6cf39
- Implemented core architecture foundation
- Files changed:
  - src/store/index.ts (Redux store with all reducers + typed hooks)
  - src/store/slices/clientSlice.ts (NEW: client state + async thunks)
  - src/store/slices/syncSlice.ts (NEW: offline sync queue state)
  - src/store/slices/index.ts (exports all slices)
  - src/services/dataService.ts (NEW: unified data access facade)
  - src/services/supabase/client.ts (NEW: Supabase client init)
  - src/services/db/database.ts (NEW: Dexie.js IndexedDB for offline)
  - src/providers/MqttProvider.tsx (NEW: MQTT context for real-time)
  - src/components/ErrorBoundary/index.tsx (NEW: error boundary)
  - src/App.tsx (refactored with Provider, ErrorBoundary, MqttProvider)
  - package.json (added @supabase/supabase-js, dexie)
- **Learnings for future iterations:**
  - The @mango/mqtt package has unresolved dependencies on parent supabase types, so check-in app uses its own lightweight MqttProvider
  - Supabase client reads from VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY env vars
  - IndexedDB tables: clients, services, technicians, checkins, syncQueue
  - All async thunks should return null (not undefined) for not-found cases
  - Error boundaries need class components (not function components)
---

## Sat Jan 10 2026 - US-003
Thread: https://ampcode.com/threads/T-019ba7ca-7a3e-7797-b4db-91456bd25518
- Implemented Phone Lookup Integration (Welcome â†’ Verify)
- Files changed:
  - src/pages/WelcomeScreen.tsx (use formatPhone from utils instead of local)
  - src/pages/VerifyPage.tsx (replaced mock lookupClient with Redux thunk)
  - src/store/slices/clientSlice.test.ts (NEW: unit tests for thunks)
  - src/pages/VerifyPage.test.tsx (NEW: integration tests for phone lookup)
  - src/testing/setup.ts (NEW: Vitest setup with mocks)
  - vitest.config.ts (NEW: Vitest configuration)
  - package.json (added testing dependencies: vitest, @testing-library/*)
- **Learnings for future iterations:**
  - Phone formatting uses (XXX) XXX-XXXX format via src/utils/index.ts formatPhone()
  - VerifyPage handles 4 states: loading, found, not_found, error
  - Use `as never` type assertion for async thunk dispatch in tests to avoid TS errors
  - Tests pass with 21 total assertions (9 unit + 12 integration)
  - Build produces 909KB bundle - code splitting should be addressed in US-023
---

## Sat Jan 10 2026 - US-004
Thread: https://ampcode.com/threads/T-019ba7e3-232b-750e-9cef-b089af584472
- Verified existing New Client Registration (SignupPage) implementation
- Files changed:
  - src/store/hooks.ts (NEW: re-exports typed hooks for modular imports)
  - src/pages/SignupPage.test.tsx (NEW: 19 integration tests for registration flow)
  - src/pages/SignupPage.tsx (updated imports to use store/hooks)
- **Learnings for future iterations:**
  - SignupPage was already fully implemented with all acceptance criteria
  - React Hook Form mode: 'onChange' doesn't trigger errors on empty field blur
  - Store hooks can be re-exported via src/store/hooks.ts for cleaner imports
  - All 40 tests pass (9 clientSlice + 12 VerifyPage + 19 SignupPage)
  - Bundle size is now ~1000KB gzipped (295KB) - still needs code splitting
---

## Sat Jan 10 2026 - US-005
Thread: https://ampcode.com/threads/T-019ba7e6-287d-773a-b26e-1553821075c1
- Implemented Service Catalog Fetch & Cache
- Files changed:
  - src/store/slices/servicesSlice.ts (NEW: fetchServices async thunk)
  - src/store/slices/servicesSlice.test.ts (NEW: 9 unit tests for services thunk)
  - src/store/slices/index.ts (added servicesReducer export)
  - src/store/index.ts (added services slice to store)
  - src/pages/ServicesPage.tsx (refactored to use Redux state, added search/filter)
  - src/pages/ServicesPage.test.tsx (NEW: 21 integration tests)
- **Learnings for future iterations:**
  - Services are fetched via dataService.services.getByCategory() which returns ServiceCategory[]
  - dataService already handles IndexedDB caching in services.getAll() - bulkPut to cache
  - Selected services stored in checkin slice (addSelectedService, removeSelectedService)
  - Search filters across all categories when query entered
  - All 69 tests pass (9 clientSlice + 12 VerifyPage + 19 SignupPage + 9 servicesSlice + 21 ServicesPage)
  - Build produces 1002KB bundle (295KB gzipped)
---

## Sat Jan 10 2026 - US-006
Thread: https://ampcode.com/threads/T-019ba7eb-e2bf-72db-afa1-66983b81f5b4
- Implemented Technician Status with MQTT Subscribe
- Files changed:
  - src/store/slices/technicianSlice.ts (NEW: fetchTechnicians thunk + MQTT status update reducers)
  - src/store/slices/technicianSlice.test.ts (NEW: 9 unit tests for technician slice)
  - src/store/slices/index.ts (added technicianReducer export)
  - src/store/index.ts (added technicians slice to store)
  - src/hooks/useTechnicianMqtt.ts (NEW: MQTT subscription hook for staff status)
  - src/hooks/index.ts (added useTechnicianMqtt export)
  - src/pages/TechnicianPage.tsx (refactored to use Redux + MQTT, added service filtering)
  - src/pages/TechnicianPage.test.tsx (NEW: 16 integration tests)
- **Learnings for future iterations:**
  - Create dedicated slice for entities fetched async (technicianSlice similar to servicesSlice)
  - MQTT subscriptions use useTechnicianMqtt hook pattern - subscribe in useEffect, dispatch to Redux
  - TechnicianPage filters by serviceIds from URL params or Redux selectedServices
  - Technicians sorted by status: available first, then with_client, on_break, unavailable
  - "Anyone Available" is default (technicianPreference: 'anyone') with recommended badge
  - Status badges use consistent color scheme: green=available, amber=with_client, gray=on_break, red=unavailable
  - All 95 tests pass (9 clientSlice + 12 VerifyPage + 19 SignupPage + 9 servicesSlice + 21 ServicesPage + 9 technicianSlice + 16 TechnicianPage)
  - Build produces 1006KB bundle (297KB gzipped)
---
