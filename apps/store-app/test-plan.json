{
  "project": "Mango POS Store App Improvements",
  "goal": "Execute security fixes, test generation, performance optimizations, and refactoring",
  "analysis_reports": "/docs/analysis/",
  "rules": {
    "one_task_at_a_time": true,
    "must_pass_before_commit": true,
    "stop_on_failure": true,
    "append_to_progress": true,
    "max_iterations": 100
  },
  "phases": [
    {
      "id": 1,
      "name": "Security Fixes",
      "report": "01-SECURITY-AUDIT.md",
      "completion_gate": "! grep -rq 'demo123\\|btoa\\|atob' src/"
    },
    {
      "id": 2,
      "name": "Test Generation",
      "report": "08-TEST-GENERATOR.md",
      "completion_gate": "pnpm test"
    },
    {
      "id": 3,
      "name": "Performance Optimizations",
      "report": "02-PERFORMANCE-PROFILER.md",
      "completion_gate": "test $(grep -r 'console.log' src/ | wc -l) -lt 100"
    },
    {
      "id": 4,
      "name": "Refactoring",
      "report": "04-REFACTOR-PLANNER.md",
      "completion_gate": "test -d src/services/dataService && test -f src/services/dataService/index.ts"
    }
  ],
  "tasks": [
    {
      "id": 1,
      "phase": 1,
      "name": "Remove hardcoded demo passwords from authService.ts",
      "file": "src/services/supabase/authService.ts",
      "line": 869,
      "priority": "critical",
      "command": "! grep -q 'demo123' src/services/supabase/authService.ts",
      "status": "skipped",
      "passes": true,
      "notes": "SKIPPED: Demo version requires hardcoded passwords for testing"
    },
    {
      "id": 2,
      "phase": 1,
      "name": "Replace base64 with Web Crypto API in secureStorage.ts",
      "file": "src/services/secureStorage.ts",
      "line": "24-40",
      "priority": "critical",
      "command": "! grep -q 'btoa\\|atob' src/services/secureStorage.ts",
      "status": "passed",
      "passes": true,
      "notes": "Replaced with AES-GCM encryption via Web Crypto API"
    },
    {
      "id": 3,
      "phase": 1,
      "name": "Add DOMPurify sanitization to FormCompletionPortal.tsx",
      "file": "src/components/forms/FormCompletionPortal.tsx",
      "line": "186-194",
      "priority": "critical",
      "command": "grep -q 'DOMPurify' src/components/forms/FormCompletionPortal.tsx",
      "status": "passed",
      "passes": true,
      "notes": "Added DOMPurify with ALLOWED_TAGS whitelist for XSS prevention"
    },
    {
      "id": 4,
      "phase": 1,
      "name": "Sanitize search inputs in clientsTable.ts",
      "file": "src/services/supabase/tables/clientsTable.ts",
      "line": 46,
      "priority": "high",
      "command": "grep -q 'sanitizeSearchQuery' src/services/supabase/tables/clientsTable.ts",
      "status": "passed",
      "passes": true,
      "notes": "Added sanitizeSearchQuery function with SQL char escaping and length limit"
    },
    {
      "id": 5,
      "phase": 1,
      "name": "Sanitize search inputs in pagination.ts",
      "file": "src/services/supabase/pagination.ts",
      "line": 327,
      "priority": "high",
      "command": "grep -q 'sanitizeSearchQuery' src/services/supabase/pagination.ts",
      "status": "passed",
      "passes": true,
      "notes": "Added sanitizeSearchQuery function with early return for empty queries"
    },
    {
      "id": 6,
      "phase": 2,
      "name": "Write tests for syncService.ts",
      "file": "src/services/__tests__/syncService.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/services/__tests__/syncService.test.ts --passWithNoTests",
      "status": "passed",
      "passes": true,
      "notes": "Created 14 tests covering status, subscribe, syncNow, queue operations"
    },
    {
      "id": 7,
      "phase": 2,
      "name": "Write tests for licenseManager.ts",
      "file": "src/services/__tests__/licenseManager.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/services/__tests__/licenseManager.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test license validation, expiry, feature checks"
    },
    {
      "id": 8,
      "phase": 2,
      "name": "Write tests for payrollCalculation.ts",
      "file": "src/utils/__tests__/payrollCalculation.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/utils/__tests__/payrollCalculation.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test commission, overtime, tip share calculations"
    },
    {
      "id": 9,
      "phase": 2,
      "name": "Write tests for dateUtils.ts",
      "file": "src/utils/__tests__/dateUtils.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/utils/__tests__/dateUtils.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test timezone handling, DST transitions, date formatting"
    },
    {
      "id": 10,
      "phase": 2,
      "name": "Write tests for checkoutSlice.ts",
      "file": "src/store/slices/__tests__/checkoutSlice.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/store/slices/__tests__/checkoutSlice.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test payment flow, discounts, completion"
    },
    {
      "id": 11,
      "phase": 2,
      "name": "Write tests for ticketsSlice.ts",
      "file": "src/store/slices/__tests__/ticketsSlice.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/store/slices/__tests__/ticketsSlice.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test ticket CRUD, status changes"
    },
    {
      "id": 12,
      "phase": 2,
      "name": "Write tests for useLicenseGuard.ts",
      "file": "src/hooks/__tests__/useLicenseGuard.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/hooks/__tests__/useLicenseGuard.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test license validation hook"
    },
    {
      "id": 13,
      "phase": 2,
      "name": "Write tests for appointmentAdapter.ts",
      "file": "src/services/supabase/adapters/__tests__/appointmentAdapter.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/services/supabase/adapters/__tests__/appointmentAdapter.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test data transformation"
    },
    {
      "id": 14,
      "phase": 2,
      "name": "Write tests for ticketAdapter.ts",
      "file": "src/services/supabase/adapters/__tests__/ticketAdapter.test.ts",
      "priority": "high",
      "command": "pnpm test -- src/services/supabase/adapters/__tests__/ticketAdapter.test.ts --passWithNoTests",
      "status": "pending",
      "passes": false,
      "notes": "Test data transformation"
    },
    {
      "id": 15,
      "phase": 2,
      "name": "Run coverage report and verify improvement",
      "priority": "high",
      "command": "pnpm test -- --coverage",
      "status": "pending",
      "passes": false,
      "notes": "Target: 30% coverage (up from 3.5%)"
    },
    {
      "id": 16,
      "phase": 3,
      "name": "Install and configure vite-plugin-remove-console",
      "file": "vite.config.ts",
      "priority": "high",
      "command": "grep -q 'removeConsole' vite.config.ts",
      "status": "pending",
      "passes": false,
      "notes": "npm install -D vite-plugin-remove-console, add to vite config"
    },
    {
      "id": 17,
      "phase": 3,
      "name": "Create memoized selectors for ticketsSlice",
      "file": "src/store/selectors/ticketSelectors.ts",
      "priority": "high",
      "command": "test -f src/store/selectors/ticketSelectors.ts",
      "status": "pending",
      "passes": false,
      "notes": "Create createSelector for tickets following appointmentSelectors pattern"
    },
    {
      "id": 18,
      "phase": 3,
      "name": "Create memoized selectors for staffSlice",
      "file": "src/store/selectors/staffSelectors.ts",
      "priority": "high",
      "command": "test -f src/store/selectors/staffSelectors.ts",
      "status": "pending",
      "passes": false,
      "notes": "Create createSelector for staff following appointmentSelectors pattern"
    },
    {
      "id": 19,
      "phase": 3,
      "name": "Lazy load NewAppointmentModal.v2",
      "file": "src/components/Book/index.tsx",
      "priority": "medium",
      "command": "grep -q 'lazy.*NewAppointmentModal' src/",
      "status": "pending",
      "passes": false,
      "notes": "Use React.lazy() and Suspense for modal"
    },
    {
      "id": 20,
      "phase": 3,
      "name": "Lazy load PaymentModal",
      "file": "src/components/checkout/index.tsx",
      "priority": "medium",
      "command": "grep -rq 'lazy.*PaymentModal' src/",
      "status": "pending",
      "passes": false,
      "notes": "Use React.lazy() and Suspense for modal"
    },
    {
      "id": 21,
      "phase": 4,
      "name": "Split dataService.ts into module structure",
      "file": "src/services/dataService/index.ts",
      "priority": "high",
      "command": "test -d src/services/dataService && test -f src/services/dataService/index.ts",
      "status": "pending",
      "passes": false,
      "notes": "Create directory structure, extract core + entity services"
    },
    {
      "id": 22,
      "phase": 4,
      "name": "Split useCatalog.ts into module structure",
      "file": "src/hooks/catalog/index.ts",
      "priority": "high",
      "command": "test -d src/hooks/catalog && test -f src/hooks/catalog/index.ts",
      "status": "pending",
      "passes": false,
      "notes": "Create directory structure, extract state + operations hooks"
    }
  ]
}
