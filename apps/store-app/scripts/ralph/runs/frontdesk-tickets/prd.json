{
  "project": "Mango POS - Front Desk Tickets (Phase 1)",
  "branchName": "ralph/frontdesk-tickets",
  "description": "Phase 1: Core ticket workflow - technician display, Redux connections, status transitions, and ticket creation. 10 stories focused on making Front Desk tickets fully functional.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Display technician on WaitListTicketCard",
      "description": "As a front desk staff, I want to see the assigned technician on waiting tickets so I know who will serve the client.",
      "files": [
        "src/components/tickets/WaitListTicketCard.tsx"
      ],
      "acceptanceCriteria": [
        "Add technician props to interface: technician?, techColor?, techId?, assignedTo?, assignedStaff?",
        "Display technician avatar (colored circle with initials) if assigned",
        "Display technician name beside avatar",
        "Handle both single technician (assignedTo) and multiple (assignedStaff)",
        "Show empty state if no technician assigned",
        "Styling matches ServiceTicketCard's technician display",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "COMPLETED. Reference ServiceTicketCard.tsx lines 32-46 for prop interface pattern."
    },
    {
      "id": "US-002",
      "title": "Display technician on PendingTicketCard",
      "description": "As a front desk staff, I want to see which technician completed the service on pending (checkout) tickets.",
      "files": [
        "src/components/tickets/PendingTicketCard.tsx"
      ],
      "acceptanceCriteria": [
        "Interface already has technician props at lines ~31-51 - add rendering JSX only",
        "Display technician avatar and name in card header area",
        "Follow same pattern as WaitListTicketCard from US-001",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Interface already defined - this story only adds rendering JSX. Add to existing card layout in header section near client name. File is in src/components/tickets/ not frontdesk/."
    },
    {
      "id": "US-003",
      "title": "Create updateTicket thunk and make EditTicketModal functional",
      "description": "As a front desk staff, I want my edits in the Edit Ticket modal to actually save and persist.",
      "files": [
        "src/store/slices/uiTicketsSlice.ts",
        "src/components/tickets/EditTicketModal.tsx"
      ],
      "acceptanceCriteria": [
        "Create updateTicket async thunk accepting { ticketId: string, updates: Partial<UITicket> }",
        "Thunk updates ticket via dataService.tickets.update() with IndexedDB fallback",
        "Add reducer case in extraReducers to update tickets, waitlist, inService, checkoutTickets",
        "In EditTicketModal: import updateTicket and useAppDispatch",
        "Replace console.log at lines ~82-91 with dispatch(updateTicket(...))",
        "Use existing isSubmitting state for loading indicator",
        "Close modal only after successful save",
        "Handle errors with try/catch and unwrap()",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Follow assignTicket thunk pattern at lines ~431-498 in uiTicketsSlice. Current handleSubmit only logs and closes - replace entirely."
    },
    {
      "id": "US-004",
      "title": "Connect TicketActions.handleAssign to Redux",
      "description": "As a front desk staff, I want assigning a technician from ticket actions to actually work.",
      "files": [
        "src/components/tickets/TicketActions.tsx"
      ],
      "acceptanceCriteria": [
        "Import assignTicket from @/store/slices/uiTicketsSlice",
        "Import useAppDispatch from @/store/hooks",
        "In handleAssign (line ~35-38), replace console.log with dispatch call",
        "Pass: { ticketId: String(ticketId), staffId: techId, staffName: techName, staffColor: techColor }",
        "Add loading state during dispatch",
        "Close modal after successful assignment",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": "assignTicket thunk already exists in uiTicketsSlice - just connect it. TicketActions is only 60 lines - simple file."
    },
    {
      "id": "US-005",
      "title": "Implement bidirectional status transitions",
      "description": "As a front desk staff, I want to move tickets between statuses (waiting <-> in-service <-> pending) when needed.",
      "files": [
        "src/store/slices/uiTicketsSlice.ts",
        "src/components/tickets/TicketActions.tsx"
      ],
      "acceptanceCriteria": [
        "Create moveToWaiting thunk: sets status to 'waiting', clears serviceStartTime",
        "Create moveToInService thunk: sets status to 'in-service', sets serviceStartTime to now",
        "Create moveToPending thunk: sets status to 'completed', sets completedAt to now",
        "Each thunk updates via dataService with IndexedDB fallback and sync queue",
        "Add reducer cases for all three thunks",
        "Export all three thunks",
        "In TicketActions: Waiting tickets get 'Start Service' -> moveToInService",
        "In TicketActions: In-service tickets get 'Move to Waiting' and 'Complete Service'",
        "In TicketActions: Support 'pending' section with 'Back to Service'",
        "Show confirmation dialog (AlertDialog) before status change",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Status values: 'waiting' | 'in-service' | 'completed' | 'paid'. 'completed' = pending checkout. Use AlertDialog from @/components/ui/alert-dialog."
    },
    {
      "id": "US-006",
      "title": "Implement daily-resetting check-in numbers",
      "description": "As a front desk staff, I want check-in numbers to reset to 1 each day for easy call-outs.",
      "files": [
        "src/store/slices/uiTicketsSlice.ts",
        "src/types/index.ts",
        "src/components/tickets/WaitListTicketCard.tsx",
        "src/components/tickets/ServiceTicketCard.tsx"
      ],
      "acceptanceCriteria": [
        "Add to uiTicketsSlice state: lastCheckInDate: string | null, lastCheckInNumber: number",
        "Add checkInNumber?: number to UITicket interface if not present",
        "Modify checkInAppointment thunk: get today's date as ISO string (YYYY-MM-DD)",
        "If lastCheckInDate !== today: reset to 1, update date",
        "Else: increment lastCheckInNumber",
        "Store checkInNumber on ticket (separate from ticket.number)",
        "In WaitListTicketCard: display checkInNumber with '#' prefix prominently",
        "In ServiceTicketCard: display checkInNumber similarly",
        "ticket.number remains permanent ID (for receipts)",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Current bug: uses lastTicketNumber which doesn't reset daily. Check-in number for vocal call-outs: 'Number 5, you're up!' Files are in src/components/tickets/ not frontdesk/."
    },
    {
      "id": "US-007",
      "title": "Implement soft delete with categorized reasons",
      "description": "As a manager, I want deleted tickets to have categorized reasons for accurate reporting.",
      "files": [
        "src/store/slices/uiTicketsSlice.ts",
        "src/components/tickets/DeleteTicketModal.tsx",
        "src/components/tickets/TicketActions.tsx"
      ],
      "acceptanceCriteria": [
        "Create DeleteReason type: 'testing' | 'client_left' | 'duplicate' | 'mistake' | 'other'",
        "Add to UITicket: deletedAt?: string, deletedReason?: DeleteReason, deletedNote?: string",
        "Modify deleteTicket thunk to soft delete (set fields, don't remove)",
        "Create DeleteTicketModal.tsx with radio buttons for reasons",
        "Include optional text field for notes",
        "'Testing' shows helper: 'Will not be counted as client loss'",
        "Delete dispatches deleteTicket({ ticketId, reason, note })",
        "In TicketActions: add 'Delete Ticket' with red/destructive styling",
        "After delete, ticket filtered from view (by deletedAt)",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Follow EditTicketModal.tsx pattern for modal structure. Use RadioGroup from @/components/ui/radio-group. Soft delete = mark as deleted, keep in DB."
    },
    {
      "id": "US-008",
      "title": "Add manager PIN verification for sensitive actions",
      "description": "As an owner, I want certain actions (like status reversal) to optionally require manager PIN.",
      "files": [
        "src/components/tickets/ManagerPinModal.tsx",
        "src/components/tickets/TicketActions.tsx"
      ],
      "acceptanceCriteria": [
        "Create ManagerPinModal.tsx with 4-digit PIN input (masked with dots)",
        "For development: accept PIN '1234' as valid",
        "Error state for invalid PIN with shake animation",
        "Max 3 attempts, then show 'Contact manager' message",
        "onSuccess callback with manager ID (hardcode 'manager-1' for dev)",
        "onCancel callback",
        "Add setting check: requirePinForStatusReversal (default: false)",
        "If enabled: show ManagerPinModal before status reversal",
        "Only proceed after PIN verified",
        "If disabled: proceed without PIN (current behavior)",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Hardcode PIN validation for now (real auth is separate PRD). Use Dialog from @/components/ui/dialog for modal."
    },
    {
      "id": "US-009",
      "title": "Connect CreateTicketModal to Front Desk with Redux",
      "description": "As a front desk staff, I want to create tickets directly from Front Desk without navigating to checkout.",
      "files": [
        "src/components/tickets/CreateTicketModal.tsx",
        "src/components/frontdesk/CreateTicketButton.tsx"
      ],
      "acceptanceCriteria": [
        "In CreateTicketModal: import createCheckoutTicket from uiTicketsSlice",
        "Replace createTicket(ticketData) with dispatch to Redux thunk",
        "Set status to 'waiting' for new walk-in tickets",
        "In CreateTicketButton: open CreateTicketModal instead of navigating to checkout",
        "Add success toast after ticket creation",
        "New ticket appears in WaitListSection immediately",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "CreateTicketModal exists at 324 lines - uses useTickets().createTicket which may need to connect to Redux."
    },
    {
      "id": "US-010",
      "title": "Add client search/selection to CreateTicketModal",
      "description": "As a front desk staff, I want to search for existing clients when creating a ticket.",
      "files": [
        "src/components/tickets/CreateTicketModal.tsx"
      ],
      "acceptanceCriteria": [
        "Add client search input with autocomplete dropdown",
        "Fetch clients from Redux: useAppSelector(selectClients)",
        "Filter clients by name as user types (minimum 2 characters)",
        "Show matching clients with name and phone number",
        "Selecting a client populates: clientName, clientId, clientType (Regular/VIP)",
        "Show 'First Visit' badge if client has no previous visits",
        "Allow 'Create New Client' option if no match",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Use existing selectClients selector from clientsSlice. Follow Command/Combobox pattern from @/components/ui/command."
    },
    {
      "id": "US-011",
      "title": "Add service selection to CreateTicketModal",
      "description": "As a front desk staff, I want to select services from the service list when creating a ticket.",
      "files": [
        "src/components/tickets/CreateTicketModal.tsx"
      ],
      "acceptanceCriteria": [
        "Replace free-text service input with searchable dropdown",
        "Fetch services from Redux: useAppSelector(selectServices)",
        "Group services by category if available",
        "Show service name, duration, and price",
        "Selecting service populates: service name, duration (auto-filled)",
        "Allow multiple service selection for combo tickets",
        "Show total estimated duration",
        "No forbidden strings: 'Test Client', 'Test Service', 'as any', 'void _'",
        "pnpm run typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Use existing services selector from servicesSlice. Follow Select/Combobox pattern from @/components/ui/select."
    }
  ]
}
